<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Expediente Anunnaki — Gestor de Partida</title>
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#0e0f12">
  <link rel="icon" href="assets/icons/icon-192.png" type="image/png">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
<header>
  <h1>Expediente Anunnaki — Gestor</h1>
  <div class="actions">
    <button id="installBtn" class="secondary">Instalar</button>
    <button id="helpBtn" class="secondary">Ayuda</button>
    <button id="darkToggle" class="secondary">Tema</button>
  </div>
</header>

<main>
  <section class="panel">
    <h2>Personaje</h2>
    <div class="grid four">
      <div><label>Nombre</label><input id="pj_nombre"></div>
      <div><label>Edad</label><input id="pj_edad" type="number" min="0"></div>
      <div><label>País</label><input id="pj_pais"></div>
      <div><label>Profesión</label><input id="pj_profesion"></div>
    </div>
  </section>

  <section class="panel">
    <h2>Atributos</h2>
    <div class="grid three">
      <div><label>Fuerza (FUE)</label><input id="atr_fue" type="number" value="0" min="-5" max="10"></div>
      <div><label>Destreza (DES)</label><input id="atr_des" type="number" value="0" min="-5" max="10"></div>
      <div><label>Percepción (PER)</label><input id="atr_per" type="number" value="0" min="-5" max="10"></div>
    </div>
    <small class="muted">Usa estos valores como modificadores en tiradas (según tus reglas).</small>
  </section>

  <section class="panel">
    <h2>Progresión</h2>
    <div class="grid four">
      <div><label>PX</label><input id="prog_px" type="number" value="0" min="0"></div>
      <div><label>PV</label><input id="prog_pv" type="number" value="0" min="0"></div>
      <div><label>PD</label><input id="prog_pd" type="number" value="0" min="0"></div>
      <div><label>€ Euros</label><input id="prog_euros" type="number" value="0" min="0"></div>
    </div>
    <div class="grid three">
      <div class="checkboxes">
        <label>Combate (niveles)</label>
        <div class="row">
          <label><input type="checkbox" class="comb" data-i="1"> 1</label>
          <label><input type="checkbox" class="comb" data-i="2"> 2</label>
          <label><input type="checkbox" class="comb" data-i="3"> 3</label>
          <label><input type="checkbox" class="comb" data-i="4"> 4</label>
        </div>
      </div>
      <div>
        <button id="recalcular" class="secondary">Recalcular PV/PD (10 PX = +1 PV; 4 PX = +1 PD)</button>
      </div>
      <div>
        <label>Sección actual</label><input id="currentSection" type="number" min="1">
      </div>
    </div>
  </section>

  <section class="panel">
    <h2>Habilidades</h2>
    <div id="skills" class="skills"></div>
    <div class="grid three">
      <input id="newSkillName" placeholder="Ej.: Persecución">
      <input id="newSkillNote" placeholder="Notas / nivel">
      <button id="addSkill">Añadir habilidad</button>
    </div>
  </section>

  <section class="panel">
    <h2>Equipo</h2>
    <div id="equipo" class="equip"></div>
    <div class="grid three">
      <input id="newItemName" placeholder="Objeto">
      <input id="newItemQty" type="number" value="1" min="0">
      <button id="addItem">Añadir objeto</button>
    </div>
  </section>

  <section class="panel">
    <h2>Tiradas</h2>
    <div class="grid four">
      <div><label>Dado</label>
        <select id="die">
          <option value="6">d6</option>
          <option value="8">d8</option>
          <option value="10">d10</option>
          <option value="12">d12</option>
          <option value="20">d20</option>
          <option value="100">d100</option>
        </select>
      </div>
      <div><label>Modificador</label><input id="modifier" type="number" value="0"></div>
      <div><label>+Atributo</label>
        <select id="attrSelect">
          <option value="0">—</option>
          <option value="FUE">FUE</option>
          <option value="DES">DES</option>
          <option value="PER">PER</option>
        </select>
      </div>
      <div class="align-end"><button id="rollBtn">Lanzar</button></div>
    </div>
    <div id="rollLog" class="log"></div>
  </section>

  <section class="panel">
    <h2>Chequeos predefinidos</h2>
    <div id="checks"></div>
    <div class="grid three">
      <input id="newCheckName" placeholder="Nombre del chequeo (Ej.: Persecución urbana)">
      <input id="newCheckSpec" placeholder="Spec: dado|dificultad|atributo (p.ej. d10|7|DES)">
      <button id="addCheck">Añadir chequeo</button>
    </div>
    <div class="grid three">
      <button id="exportChecks" class="secondary">Exportar chequeos (.json)</button>
      <label class="file">Importar chequeos <input id="importChecks" type="file" accept=".json,application/json"></label>
    </div>
    <small class="muted">Pulsa en un chequeo para tirar automáticamente con su dado y atributo; compara con la dificultad.</small>
  </section>

  <section class="panel">
    <h2>Registro de decisiones</h2>
    <div class="grid three">
      <input id="decisionText" placeholder="Describe la decisión / pista">
      <input id="decisionSection" type="number" placeholder="§ (opcional)">
      <button id="logDecision">Registrar</button>
    </div>
    <div id="decisionLog" class="log"></div>
  </section>

  <section class="panel">
    <h2>Notas</h2>
    <textarea id="notes" rows="6" placeholder="Códigos, nombres, ideas..."></textarea>
  </section>

  <section class="panel">
    <h2>Guardar / Cargar</h2>
    <div class="grid three">
      <button id="saveBtn">Guardar</button>
      <button id="exportBtn">Exportar .anu2</button>
      <label class="file">Importar .anu/.anu2 <input id="importInput" type="file" accept=".anu,.anu2,application/json"></label>
    </div>
    <small class="muted">Guardado automático cada 30s.</small>
  </section>
</main>

<div id="helpModal" class="modal hidden">
  <div class="modal-content">
    <h3>Ayuda rápida</h3>
    <ul>
      <li>Guarda la § donde te quedes y registra las decisiones riesgosas.</li>
      <li>Usa <b>Chequeos predefinidos</b> para pruebas frecuentes; ej.: “Persecución” (DES+d10 ≥ 7).</li>
      <li>Exporta tu partida <code>.anu2</code> antes de una ruta peligrosa.</li>
      <li>Para instalar en iPhone: Safari → Compartir → Añadir a pantalla de inicio.</li>
    </ul>
    <button id="closeHelp">Cerrar</button>
  </div>
</div>

<footer>
  <small>Gestor para uso personal. No incluye texto del libro. © 2025</small>
</footer>

<script src="app.js"></script>
</body>
</html>
